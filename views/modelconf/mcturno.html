{{extend 'layout.html'}}
<h1> {{ = T('Turno coeffcients') }}</h1>

<b>{{ =T('Actions:') }}</b>

<!-- grid toolbar -->
<div class="btn-group">
	<a data-toggle="modal" onclick="return newDialogShow('{{ =actionURL }}')" class="btn btn-inverse btn-small" title="{{=T('Add new record to this table')}}">	
	<i class="icon-plus-sign icon-white"></i> {{ =T('Add record') }}</a>
</div>
<div class="btn-group">
	<button class="btn btn-inverse btn-small" title="{{ =T('Export data of this table')}}"><i class="icon-hand-right icon-white"></i>{{ =T('Export') }}</button>
	<button class="btn btn-inverse btn-small dropdown-toggle" data-toggle="dropdown">
	<span class="caret"></span>
	</button>
    <ul class="dropdown-menu">
	    <li><a href="#">EAction1</a></li>
	    <li><a href="#">EAction2</a></li>
	    <li><a href="#">EAction3</a></li>
	    <li class="divider"></li>
	    <li><a href="#">EAction4</a></li>
    </ul>  
</div>
<div class="btn-group">    
	<button class="btn btn-inverse btn-small" title="{{ =T('Import data from file')}}"><i class="icon-hand-left icon-white"></i>{{ =T('Import') }}</button>
	<button class="btn btn-inverse btn-small dropdown-toggle" data-toggle="dropdown">
	<span class="caret"></span>
	</button>
    <ul class="dropdown-menu">
	    <li><a href="#">IAction1</a></li>
	    <li><a href="#">IAction2</a></li>
	    <li><a href="#">IAction3</a></li>
	    <li class="divider"></li>
	    <li><a href="#">IAction4</a></li>
    </ul>    
</div>
<div class="btn-group">
    <a data-toggle="modal" onclick="return deleteAllDialogShow('{{ =actionURL }}')" class="btn btn-warning btn-small" title="{{=T('Delete all records in this table')}}">   
    <i class="icon-remove icon-white"></i> {{ =T('Delete all') }}</a>
</div>
<!-- grid toolbar -->
{{ =grid }}

<!-- Edit Dialog -->
<div id="editDialog" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="editLabel" aria-hidden="true" style="display: none;">
	<div class="modal-header">
		<a href="#" class="close" data-dismiss="modal">×</a>
		<h3>{{ =T('Edit record') }}</h3>
	</div>
	<div class="modal-body">
		<div id="editResult" class="center">		
		</div>
	</div>
	
	<div class="modal-footer">		
		<a href="#" id="save"  class="btn btn-primary" onclick="editDialogSave();"> {{ =T('Save') }} </a>
		<a href="#" id="close" class="btn" onclick="editDialogClose();"> {{ =T('Close') }} </a>
	</div>
</div>

<!-- Delete Dialog -->
<div id="deleteDialog" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="deleteLabel" aria-hidden="true" style="display: none;">
	<div class="modal-header">
		<a href="#" class="close" data-dismiss="modal">×</a>
		<h3> {{=T('Delete confirmation')}}</h3>
	</div>
	<div class="modal-body">
		{{=T('Are you sure?. Delete this record?')}}
        <div id="deleteResult" class="center">     
        </div>
	</div>	
	<div class="modal-footer">
		<a href="#" id="delete" class="btn btn-warning" onclick="deleteDialogDelete();">{{ =T('Delete') }}</a>
		<a href="#" id="close" class="btn" onclick="deleteDialogClose();">{{ =T('Cancel') }}</a>		
	</div>
</div>

<!-- New Dialog -->
<div id="newDialog" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="editLabel" aria-hidden="true" style="display: none;">
	<div class="modal-header">
		<a href="#" class="close" data-dismiss="modal">×</a>
		<h3>{{ =T('New record') }}</h3>
	</div>
	<div class="modal-body">
		<div id="newResult" class="center">		
		</div>
	<div class="modal-footer">		
		<a href="#" id="save" class="btn btn-primary" onclick="newDialogSave();"> {{ =T('Save') }} </a>
		<a href="#" id="close" class="btn" onclick="newDialogClose();"> {{ =T('Close') }} </a>
	</div>
</div>

<script>
	/*RFPV - Dialog code*/
	//variables globales para la acción
	var currentRecordId=-1; /* Current record Id */
	var currentURLAction=''; /* Current URL action */
	
	$(document).ready(function() {
		/*
		$('#windowTitleDialog').bind('show', function () {
			document.getElementById ("xlInput").value = document.title;
		});
		*/
	});	
	
    function newDialogShow(url) {
        $("#newDialog").modal();
        currentRecordId=-1;
        currentURLAction=url;
        // POST via ajax
        $.post(
            url,
            {dataAction:'new'},            
            function(data) {
                $('#newResult').html(data);
            }
        );
        //return false dont process href on a       
        return false;
    };
    
    function newDialogClose() {
        $('#newDialog').modal('hide'); 
    };
    
    function newDialogSave() {
        // POST form via ajax
        $.post(
            currentURLAction,
            {dataAction:'new'},            
            function(data) {
                //Parse string as JSON
                // var jsonData = jQuery.parseJSON(data);
                if (data.result==true) {
                    // Data added, reload current page
                    location.reload();
                } else {
                    alert(data.message);
                }
            },
            'json' //data returned is json            
        );
        newDialogClose();
        currentRecordId=-1;
        currentURLAction='';
    };
	
	function editDialogShow (url,recordId) {
		$("#editDialog").modal();
		currentRecordId=recordId;
		currentURLAction=url;
        // POST via ajax
        $.post(
            url,
            {dataAction:'new', dataId:recordId},            
            function(data) {
                $('#editResult').html(data);
            }
        );        
		//return false dont process href on a
		return false;
	};
	
	function editDialogClose() {
		$('#editDialog').modal('hide'); 
	};
	
	function editDialogSave() {
		//Do something
		editDialogClose();
		currentRecordId=-1;
		currentURLAction='';
	};	

    function deleteDialogShow(url,recordId) {
        $("#deleteDialog").modal();
        currentRecordId=recordId;
        currentURLAction=url;
        //Write HTML table of record to modal dialog data area
        var title=tableGetHeaders();
        var data=tableGetRowById(currentRecordId);
        tableWrite(title, data, "deleteResult");
        //return false dont process href on a
        return false;
    };
    
    function deleteDialogClose() {
        $('#deleteDialog').modal('hide'); 
    };
    
    function deleteDialogDelete() {
        $.post(
            currentURLAction,
            {dataAction:'delete', dataId:currentRecordId},            
            function(data) {
                //Parse string as JSON
                // var jsonData = jQuery.parseJSON(data);
                if (data.result==true) {
                    // Delete row?
                    //tableDeleteRowById(currentRecordId);
                    // Reload current page
                    location.reload();
                } else {
                    alert(data.message);
                }
            },
            'json' //data returned is json            
        );        
        deleteDialogClose();
        currentRecordId=-1;
        currentURLAction='';
    };	
	
	function tableWrite(tit, dat, target) {
        /** Write html table with tit, dat
        in this target
        */
        var html = '<table class="show-data">\n';
        len = dat.length;
        for (var i = 0; i < len; i++)
        {
            html += '<tr><td class="cell-title">' + tit[i] + '</td><td class="cell-data">' + dat[i] + '</td></tr>';
        }
        html += '</table>\n';
        $('#' + target).html(html);
	}
	
	function tableGetRowById(rowId, initCol, endCol) {
        /** Get row (total o partoally) by his id (<tr id=1>) and return
        an array 
        */
        cellArr = new Array();
        // Get text of each cell in this table row
        $('table tr#' + rowId + ' td').each(function(){
            cellArr.push($(this).text());
        });
        
        if (typeof(initCol)==='undefined') {
            initCol=0;
        }
        
        // Dont get last col 
        if (typeof(endCol)==='undefined') {
            if (cellArr.length==1) {
                endCol=0;
            } else {
              endCol=cellArr.length-1;  
            }
        }
        
        return cellArr.slice( initCol, endCol);
	};

    function tableGetHeaders(initCol, endCol) {
        /** Get heders (total o partoally) of a table
        */    
        cellArr = new Array();
        // Get text of each cell in this table row
        $('table tr th').each(function(){
            cellArr.push($(this).text());
        });
        
        if (typeof(initCol)==='undefined') {
            initCol=0;
        } else {
            if ( (initCol<0) || (initCol>(cellArr.length-1)) ) {
                initCol=0;
            }
        } 
        
        // Dont get last col 
        if (typeof(endCol)==='undefined') {
            endCol=cellArr.length-1;
        } else {
            if ( (endCol<0) || (endCol>(cellArr.length-1)) ) {
                endCol=initCol+1;
            }
        }
        
        return cellArr.slice(initCol, endCol);
    };
	
    function tableDeleteRowById(rowId) {
        /** Delete arow in a table by his id 
        */
        $('table tr#' + rowId).remove();
    };    
</script> 
